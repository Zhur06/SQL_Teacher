unit Unit2;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, StdCtrls;

type
  TForm2 = class(TForm)
    Label1: TLabel;
    dbName: TEdit;
    Label2: TLabel;
    dbWay: TLabel;
    Button1: TButton;
    Button2: TButton;
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
    procedure FormCreate(Sender: TObject);
    procedure FormActivate(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form2: TForm2;

implementation

{$R *.dfm}

Uses Unit1, IniFiles;

procedure TForm2.Button1Click(Sender: TObject);
begin
  Form1.OpenDialog1.InitialDir := ExtractFilePath(ParamStr(0));

  if Form1.OpenDialog1.Execute then
  begin
    dbWay.Caption := Form1.OpenDialog1.FileName;
  end;

  Button1.Left := dbWay.Left + dbWay.Width + 10;
end;

procedure TForm2.Button2Click(Sender: TObject);
var Ini: Tinifile; i: integer;
begin
  Ini := TIniFile.Create(ExtractFilePath(ParamStr(0)) + '\meta_inf\1.ini');
  If not (Ini.ReadString('ComboBox', IntToStr(Ini.ReadInteger('ComboBox','MaxValue',0)), '') = '') then
  begin
    Ini.WriteInteger('ComboBox', 'MaxValue', Ini.ReadInteger('ComboBox','MaxValue',0) + 1);
    Ini.WriteString('ComboBox', IntToStr(Ini.ReadInteger('ComboBox','MaxValue',0)), dbName.Text);
  end
  else
    For i := Ini.ReadInteger('ComboBox','MaxValue', 1) downto 1 do
    begin
      if Ini.ReadString('ComboBox', IntToStr(i - 1), '') <> '' then
      begin
        Ini.WriteInteger('ComboBox', 'MaxValue', i);
        Ini.WriteString('ComboBox', IntToStr(i), dbName.Text);
        BREAK;
      end;
    end;

  Form1.ComboBox1.AddItem(dbName.Text, Self);
  Ini.Free;

  Form1.MyScript1.SQL.LoadFromFile(dbWay.Caption);
  Form1.MyScript1.Execute();

end;

procedure TForm2.FormActivate(Sender: TObject);
begin
  Form2.Left:= (Screen.WorkAreaWidth - Form2.Width) div 2;
  Form2.Top:= (Screen.WorkAreaHeight - Form2.Height) div 2;
end;

end.
